BOBBYTHEBOT CODEBASE ANALYSIS - Generated November 6, 2025

=== 1. ENTRY POINT ===
index.js - Creates Discord client, registers 23+ event handlers
- Uses Discord.js v14.15.3
- Intents: Guilds, GuildMessages, MessageContent, DirectMessages, etc.
- MongoDB optional for data persistence
- HTTP health check server on port 3000
- Restricted to guild: 701308904877064193 (Cracked Hive)

=== 2. EVENT HANDLERS (in events/ directory) ===
Total: 23 handlers following standard pattern

module.exports = (client, ...config) => {
  client.on('eventType', async (data) => {
    // All check: if (message.guild?.id !== TARGET_GUILD_ID) return;
    // Logging, validation, rate limiting, error handling
  });
};

Core Handlers:
- loggingHandler: Message delete/edit/ban logging
- alertHandler: Keyword detection (ban, kick, trouble)
- bumpHandler: DISBOARD bump detection + 2hr reminders

Game Handlers:
- blackjackHandler, gamblingHandler, pokerHandler
- gladiatorHandler, kothHandler, thinIceHandler
- wordleHandler, triviaHandler, mafiaHandler
- russianRouletteHandler, eggbuckHandler

Valorant:
- valorantApiHandler, valorantMapHandler, valorantTeamHandler
- valorantInhouseHandler

Other:
- askHandler (AI with OpenAI/Gemini)
- socialMediaPostHandler (Instagram Graph API)
- moderationHandler, interactionHandler, helpHandler
- birthdayHandler, memberCountHandler, boosterRoleHandler
- clipHandler, messageReactionHandler

=== 3. CHANNEL POSTING ===
Patterns Already Used:

1. Direct Send:
const channel = client.channels.cache.get(channelId);
await channel.send({content: '...', embeds: [...], components: [...]});

2. Embeds:
const embed = new EmbedBuilder()
  .setColor(0xFF0000)
  .setTitle('Title')
  .addFields({name: 'Field', value: 'Value'})
  .setTimestamp();

3. External API (Instagram example):
axios.post(graphApiUrl, {image_url, caption, access_token});

Configured Channel IDs (data/config.js):
- updates: 1276298066789535765          <-- PERFECT FOR CHANGELOG
- repo: 1395453341890248754
- loggingChannelId: 1276266582234103808
- alertChannelId: 1276267465227108455

=== 4. CONFIGURATION ===
data/config.js:
- roleMessageIds: 9 channel IDs
- roleMappings: emoji/name to role ID
- topEggRoleId, thinIceRoleId
- alertKeywords, API keys

config/guildConfig.js:
- TARGET_GUILD_ID: 701308904877064193
- SERVER_INVITE_LINK

.env:
DISCORD_BOT_TOKEN (required)
OPENAI_API_KEY, GEMINI_API_KEY, VALORANT_API_KEY (optional)
MONGODB_URI (optional)
INSTAGRAM_* (optional)
PORT=3000

=== 5. MEMORY MANAGEMENT ===
utils/memoryUtils.js provides:
- LimitedMap (auto-evicting with maxSize)
- CleanupMap (time-based expiration)
- Helper functions for cleanup
- getMemoryStats()

Used by game handlers for state management.
Perfect for caching commits!

=== 6. DATABASE ===
database/connection.js:
- MongoDB optional connection
- Mongoose ORM
- Graceful if not configured

data/ directory stores:
- bobby_bucks.txt, leveling.txt, etc. for game state
- *.json files for configs
- user data, valorant mappings

=== 7. GIT INTEGRATION ===
Remote: https://github.com/ChrisAtwell27/BobbyTheBot.git

Recent commits show:
1414db5 Add memory management utilities and apply to event handlers
4ef0b6e Restrict trivia admin commands to Top Egg role
df61042 Restrict bot functionality to target guild only
a040345 Restrict bot commands to target server
686f314 Restrict bot functionality to Cracked Hive server

Perfect source for changelog posts!

=== 8. RECOMMENDED CHANGELOG HANDLER ===

Create: events/changelogHandler.js

const axios = require('axios');
const { LimitedMap } = require('../utils/memoryUtils');

module.exports = (client) => {
  const lastCommitCache = new LimitedMap(100);
  const CHANGELOG_CHANNEL_ID = '1276298066789535765';
  const CHECK_INTERVAL = 5 * 60 * 1000;
  
  setInterval(async () => {
    try {
      // Get latest commits from GitHub API
      const commits = await axios.get(
        'https://api.github.com/repos/ChrisAtwell27/BobbyTheBot/commits',
        {headers: {'Authorization': 'token ' + process.env.GITHUB_TOKEN}}
      );
      
      for (const commit of commits.data) {
        if (!lastCommitCache.has(commit.sha)) {
          // Format and post embed
          const embed = new EmbedBuilder()
            .setColor(0x238636)
            .setTitle(commit.commit.message.split('\n')[0])
            .setDescription(commit.commit.message)
            .addFields(
              {name: 'Author', value: commit.commit.author.name, inline: true},
              {name: 'Branch', value: 'main', inline: true},
              {name: 'SHA', value: commit.sha.slice(0,7), inline: true}
            )
            .setTimestamp(new Date(commit.commit.author.date));
          
          const channel = client.channels.cache.get(CHANGELOG_CHANNEL_ID);
          await channel.send({embeds: [embed]});
          
          lastCommitCache.set(commit.sha, Date.now());
        }
      }
    } catch (error) {
      console.error('[Changelog] Error:', error);
    }
  }, CHECK_INTERVAL);
};

Register in index.js (before login):
require('./events/changelogHandler')(client);

Add to data/config.js:
changelogChannelId: '1276298066789535765'

Add to .env:
GITHUB_TOKEN=your_github_pat_token

=== 9. IMPLEMENTATION STEPS ===

1. Create events/changelogHandler.js
2. Add registration to index.js
3. Update data/config.js
4. Add GITHUB_TOKEN to .env
5. Test with mock data
6. Deploy and monitor

=== 10. KEY POINTS ===

Strengths:
- Modular handler system
- Centralized config
- Memory-conscious design
- Good error handling
- Guild restrictions built-in
- Rich messaging capabilities

Ready to Use:
- Channel posting patterns
- Embed formatting
- LimitedMap for caching
- Configuration system
- Error handling patterns

Must Add:
- GitHub API polling
- Commit formatting
- Deduplication
- GitHub integration

Challenges:
- API rate limiting
- Initial commit backlog
- Message length limits
- Timezone handling

Perfect Channel Exists:
updates: 1276298066789535765

